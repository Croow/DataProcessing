<!-- Caroline Azeau
	 10334858
	 -->

<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>KNMI Data 2000</title>
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>

<h1>Maximum temperature in 2000 at The Bilt in degrees Celsius</h1>

<textarea id='json'>
[["2000/01/01", 81], ["2000/01/02", 87], ["2000/01/03", 96], ["2000/01/04", 94], ["2000/01/05", 74], ["2000/01/06", 91], ["2000/01/07", 74], ["2000/01/08", 81], ["2000/01/09", 70], ["2000/01/10", 43], ["2000/01/11", 44], ["2000/01/12", 26], ["2000/01/13", 36], ["2000/01/14", 40], ["2000/01/15", 54], ["2000/01/16", 69], ["2000/01/17", 75], ["2000/01/18", 86], ["2000/01/19", 56], ["2000/01/20", 61], ["2000/01/21", 78], ["2000/01/22", 61], ["2000/01/23", 44], ["2000/01/24", 9], ["2000/01/25", 28], ["2000/01/26", 55], ["2000/01/27", 38], ["2000/01/28", 59], ["2000/01/29", 113], ["2000/01/30", 103], ["2000/01/31", 108], ["2000/02/01", 102], ["2000/02/02", 90], ["2000/02/03", 91], ["2000/02/04", 92], ["2000/02/05", 118], ["2000/02/06", 89], ["2000/02/07", 94], ["2000/02/08", 119], ["2000/02/09", 85], ["2000/02/10", 82], ["2000/02/11", 89], ["2000/02/12", 69], ["2000/02/13", 83], ["2000/02/14", 80], ["2000/02/15", 91], ["2000/02/16", 63], ["2000/02/17", 79], ["2000/02/18", 84], ["2000/02/19", 68], ["2000/02/20", 78], ["2000/02/21", 60], ["2000/02/22", 65], ["2000/02/23", 100], ["2000/02/24", 97], ["2000/02/25", 92], ["2000/02/26", 95], ["2000/02/27", 123], ["2000/02/28", 127], ["2000/02/29", 88], ["2000/03/01", 82], ["2000/03/02", 82], ["2000/03/03", 102], ["2000/03/04", 54], ["2000/03/05", 75], ["2000/03/06", 84], ["2000/03/07", 129], ["2000/03/08", 129], ["2000/03/09", 136], ["2000/03/10", 99], ["2000/03/11", 116], ["2000/03/12", 123], ["2000/03/13", 103], ["2000/03/14", 102], ["2000/03/15", 87], ["2000/03/16", 104], ["2000/03/17", 108], ["2000/03/18", 91], ["2000/03/19", 104], ["2000/03/20", 109], ["2000/03/21", 101], ["2000/03/22", 158], ["2000/03/23", 134], ["2000/03/24", 123], ["2000/03/25", 118], ["2000/03/26", 105], ["2000/03/27", 91], ["2000/03/28", 52], ["2000/03/29", 78], ["2000/03/30", 78], ["2000/03/31", 78], ["2000/04/01", 89], ["2000/04/02", 143], ["2000/04/03", 168], ["2000/04/04", 160], ["2000/04/05", 77], ["2000/04/06", 109], ["2000/04/07", 131], ["2000/04/08", 128], ["2000/04/09", 155], ["2000/04/10", 104], ["2000/04/11", 124], ["2000/04/12", 85], ["2000/04/13", 92], ["2000/04/14", 117], ["2000/04/15", 136], ["2000/04/16", 133], ["2000/04/17", 150], ["2000/04/18", 157], ["2000/04/19", 180], ["2000/04/20", 174], ["2000/04/21", 182], ["2000/04/22", 181], ["2000/04/23", 133], ["2000/04/24", 170], ["2000/04/25", 206], ["2000/04/26", 224], ["2000/04/27", 195], ["2000/04/28", 230], ["2000/04/29", 144], ["2000/04/30", 149], ["2000/05/01", 171], ["2000/05/02", 120], ["2000/05/03", 140], ["2000/05/04", 193], ["2000/05/05", 253], ["2000/05/06", 265], ["2000/05/07", 275], ["2000/05/08", 257], ["2000/05/09", 256], ["2000/05/10", 270], ["2000/05/11", 251], ["2000/05/12", 260], ["2000/05/13", 253], ["2000/05/14", 271], ["2000/05/15", 289], ["2000/05/16", 296], ["2000/05/17", 168], ["2000/05/18", 152], ["2000/05/19", 136], ["2000/05/20", 161], ["2000/05/21", 123], ["2000/05/22", 157], ["2000/05/23", 186], ["2000/05/24", 188], ["2000/05/25", 153], ["2000/05/26", 173], ["2000/05/27", 170], ["2000/05/28", 133], ["2000/05/29", 148], ["2000/05/30", 150], ["2000/05/31", 189], ["2000/06/01", 198], ["2000/06/02", 215], ["2000/06/03", 252], ["2000/06/04", 218], ["2000/06/05", 160], ["2000/06/06", 163], ["2000/06/07", 166], ["2000/06/08", 222], ["2000/06/09", 296], ["2000/06/10", 207], ["2000/06/11", 195], ["2000/06/12", 212], ["2000/06/13", 198], ["2000/06/14", 205], ["2000/06/15", 192], ["2000/06/16", 182], ["2000/06/17", 212], ["2000/06/18", 287], ["2000/06/19", 335], ["2000/06/20", 336], ["2000/06/21", 269], ["2000/06/22", 200], ["2000/06/23", 198], ["2000/06/24", 176], ["2000/06/25", 151], ["2000/06/26", 161], ["2000/06/27", 175], ["2000/06/28", 172], ["2000/06/29", 175], ["2000/06/30", 194], ["2000/07/01", 165], ["2000/07/02", 249], ["2000/07/03", 245], ["2000/07/04", 235], ["2000/07/05", 191], ["2000/07/06", 202], ["2000/07/07", 170], ["2000/07/08", 158], ["2000/07/09", 149], ["2000/07/10", 198], ["2000/07/11", 160], ["2000/07/12", 177], ["2000/07/13", 176], ["2000/07/14", 168], ["2000/07/15", 161], ["2000/07/16", 182], ["2000/07/17", 162], ["2000/07/18", 172], ["2000/07/19", 202], ["2000/07/20", 222], ["2000/07/21", 176], ["2000/07/22", 198], ["2000/07/23", 213], ["2000/07/24", 238], ["2000/07/25", 216], ["2000/07/26", 178], ["2000/07/27", 216], ["2000/07/28", 221], ["2000/07/29", 206], ["2000/07/30", 222], ["2000/07/31", 232], ["2000/08/01", 277], ["2000/08/02", 229], ["2000/08/03", 225], ["2000/08/04", 218], ["2000/08/05", 217], ["2000/08/06", 224], ["2000/08/07", 224], ["2000/08/08", 223], ["2000/08/09", 238], ["2000/08/10", 209], ["2000/08/11", 235], ["2000/08/12", 239], ["2000/08/13", 289], ["2000/08/14", 271], ["2000/08/15", 224], ["2000/08/16", 234], ["2000/08/17", 233], ["2000/08/18", 230], ["2000/08/19", 240], ["2000/08/20", 239], ["2000/08/21", 203], ["2000/08/22", 212], ["2000/08/23", 213], ["2000/08/24", 229], ["2000/08/25", 212], ["2000/08/26", 262], ["2000/08/27", 205], ["2000/08/28", 199], ["2000/08/29", 214], ["2000/08/30", 202], ["2000/08/31", 202], ["2000/09/01", 211], ["2000/09/02", 181], ["2000/09/03", 186], ["2000/09/04", 166], ["2000/09/05", 213], ["2000/09/06", 171], ["2000/09/07", 186], ["2000/09/08", 192], ["2000/09/09", 201], ["2000/09/10", 232], ["2000/09/11", 239], ["2000/09/12", 211], ["2000/09/13", 206], ["2000/09/14", 210], ["2000/09/15", 214], ["2000/09/16", 201], ["2000/09/17", 162], ["2000/09/18", 203], ["2000/09/19", 221], ["2000/09/20", 170], ["2000/09/21", 185], ["2000/09/22", 211], ["2000/09/23", 208], ["2000/09/24", 200], ["2000/09/25", 205], ["2000/09/26", 232], ["2000/09/27", 203], ["2000/09/28", 172], ["2000/09/29", 196], ["2000/09/30", 196], ["2000/10/01", 163], ["2000/10/02", 167], ["2000/10/03", 166], ["2000/10/04", 156], ["2000/10/05", 180], ["2000/10/06", 140], ["2000/10/07", 145], ["2000/10/08", 126], ["2000/10/09", 146], ["2000/10/10", 121], ["2000/10/11", 136], ["2000/10/12", 152], ["2000/10/13", 164], ["2000/10/14", 123], ["2000/10/15", 127], ["2000/10/16", 155], ["2000/10/17", 156], ["2000/10/18", 122], ["2000/10/19", 163], ["2000/10/20", 162], ["2000/10/21", 184], ["2000/10/22", 192], ["2000/10/23", 198], ["2000/10/24", 145], ["2000/10/25", 152], ["2000/10/26", 137], ["2000/10/27", 128], ["2000/10/28", 144], ["2000/10/29", 131], ["2000/10/30", 135], ["2000/10/31", 120], ["2000/11/01", 100], ["2000/11/02", 114], ["2000/11/03", 114], ["2000/11/04", 111], ["2000/11/05", 105], ["2000/11/06", 116], ["2000/11/07", 96], ["2000/11/08", 94], ["2000/11/09", 90], ["2000/11/10", 91], ["2000/11/11", 105], ["2000/11/12", 98], ["2000/11/13", 101], ["2000/11/14", 94], ["2000/11/15", 75], ["2000/11/16", 92], ["2000/11/17", 82], ["2000/11/18", 84], ["2000/11/19", 116], ["2000/11/20", 79], ["2000/11/21", 79], ["2000/11/22", 111], ["2000/11/23", 113], ["2000/11/24", 92], ["2000/11/25", 96], ["2000/11/26", 94], ["2000/11/27", 86], ["2000/11/28", 148], ["2000/11/29", 136], ["2000/11/30", 124], ["2000/12/01", 135], ["2000/12/02", 125], ["2000/12/03", 108], ["2000/12/04", 94], ["2000/12/05", 122], ["2000/12/06", 123], ["2000/12/07", 117], ["2000/12/08", 149], ["2000/12/09", 111], ["2000/12/10", 117], ["2000/12/11", 134], ["2000/12/12", 139], ["2000/12/13", 129], ["2000/12/14", 100], ["2000/12/15", 72], ["2000/12/16", 51], ["2000/12/17", 55], ["2000/12/18", 42], ["2000/12/19", 62], ["2000/12/20", 31], ["2000/12/21", 25], ["2000/12/22", 10], ["2000/12/23", 18], ["2000/12/24", 11], ["2000/12/25", 9], ["2000/12/26", -7], ["2000/12/27", -4], ["2000/12/28", 27], ["2000/12/29", 33], ["2000/12/30", 35], ["2000/12/31", 23]]
</textarea>

<canvas id='canvas' width="1200" height="800"></canvas>

<canvas id='crosshair' width="1200" height="800" style="cursor:crosshair"></canvas>

<div id='popup'></div>

<p>In the graph below you can see the maximum temperatures in degrees Celsius at the Bilt in 2000. Slide over the graph and find out the exact temperature on a given date!</p>

<script>

	"use strict";

	var timeout;

	// Turn the JSON data into an array
	function loadJSON(){
		var data = document.getElementById('json').value;
		var data_array = JSON.parse(data);
		return data_array;
	}

  function pullData(data_array){
    var dates = [];
    var temps = [];
    for (var i = 0; i <= data_array.length - 1; i++) {
      var data = data_array[i];
      var date = new Date(data[0]);
      var milli = date.getTime();
      dates.push(milli)
      temps.push(data[1])
    };
    var min_temp = Math.min.apply(Math, temps);
    var max_temp = Math.max.apply(Math, temps);
    var width = document.getElementById('canvas').getAttribute("width");
    var height = document.getElementById('canvas').getAttribute("height");
    return [dates,temps, min_temp, max_temp, width, height]
  };

	// Define a linear transformation function
	function createTransform(domain, range, inverse){
		var a = (range[1] - range[0]) / (domain[1] - domain[0]);
		var b = range[0] - a * domain[0];
		if (inverse) {
			return function(x){
				return (x - b) / a ;
			}
		} else {
			return function(x){
				return a * x + b;
			};
		}
	}

	// Define the function to draw the axis
	function draw_axis() {
	  	var canvas = document.getElementById('canvas');
	  	var spacing = 50;
	  	if (canvas.getContext){
    		var context = canvas.getContext('2d');
	  		context.beginPath();
	  		context.moveTo(spacing, 0);
	  		context.lineTo(spacing, height - spacing);
	  		context.lineTo(width, height - spacing);
	  		context.stroke();
	  	}
	}

	// Define the function to draw the text around the axis
	function draw_text(rawdata) {
  		var canvas = document.getElementById('canvas')

  		// Put the first day of the month, the name of the month and te temperatures in an array
  		var months = [0, 30, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334, 365];
  		var month_names = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
  		var temps = [0, 50, 100, 150, 200, 250, 300, 350];

  		// Define the number of px to center the text, to create space and to place the tickmarks
  		var text_centering = 30;
  		var spacing_1 = 50;
  		var spacing_2 = 15;
  		var tickmark = 2;

  		// Create a transform function for the x-values and the y-values
  		var x = createTransform([0, rawdata.length - 1], [spacing_1, width], false);
  		var y = createTransform([min_temp - spacing_1, max_temp + text_centering], [spacing_1, height], false);

  		// Change first day of the months to the needed pixel values
  		for (var i = 0 ; i < months.length; i++) {
  			months[i] = x( months[i] );
  		};

  		// Change the temperatures to the needed pixel values
  		var temps_canvas = [];
  		for (var i = 0 ;i < temps.length; i++) {
  			temps_canvas[i] = y( temps[i] );
  		};

  		// Start drawing the texts
  		if (canvas.getContext) {
  			var context = canvas.getContext('2d');
  			context.font = "bold 16px serif";
  			context.fillText("TEMPERATURE", spacing_2, spacing_2);
  			context.fillText("DATE", width - spacing_1, height - spacing_2);

  			// Draw the names of the months on the x axis
  			for (var i = 0 ; i < months.length ; i++) {
  				context.fillText(month_names[i], months[i] + text_centering, height - text_centering);
  			}

  			// Draw the tickmarks on the x axis
  			for (var i = 0; i < months.length; i++) {
  				context.beginPath();
  				context.moveTo(months[i], height - spacing_1 - tickmark);
  				context.lineTo(months[i],height - spacing_1 + tickmark);
  				context.stroke();
  			};

  			// Draw the tickmarks on the y axis and draw the temperature values
  			for (var i = 0; i < temps_canvas.length; i++) {
  				context.beginPath();
  				context.moveTo(spacing_1 - tickmark, height - temps_canvas[i]);
  				context.lineTo(spacing_1 + tickmark,height - temps_canvas[i]);
  				context.stroke();
  				context.fillText(temps[i] / 10, text_centering, height - temps_canvas[i]);
  			};
  		};
	};

	// Define the function to draw the graph
	function draw(data_1, data_2, color) {
  		var canvas = document.getElementById('canvas');

  		// Define the number of px to create space
  		var spacing_1 = 50;
  		var spacing_2 = 30;

  		// Create a transform function for the x-values and the y-values
  		var tx = createTransform([data_1[0], data_1[data_1.length - 1]], [spacing_1, width], false);
		  var ty = createTransform([min_temp - spacing_1, max_temp + spacing_2], [spacing_1, height], false);

		  // Start drawing the line
  		if (canvas.getContext) {
    		var context = canvas.getContext('2d');
    		var begin_x = tx( data_1[0] );
    		var begin_y = ty( data_2[0] );
    		context.beginPath();
    		context.moveTo(begin_x, height - begin_y);
    		for (var i = 1; i < data_1.length; i++) {
    			var new_x = tx( data_1[i] );
    			var new_y = ty( data_2[i] );
    			context.lineTo(new_x, height - new_y);
    		};
    		context.lineWidth = 5;
    		context.strokeStyle = color;
    		context.stroke();
    	};
    };
    

    // Define the function to draw the popup
    function drawPopup(data_x, data_y, x, y) {
    	var popup = document.getElementById("popup");
    	var popupInfo = [data_x, " " + data_y / 10];
    	var popupInfoString = popupInfo.toString();
    	popup.style.top = y * 1 + "px";
    	popup.style.left = x * 1 + 70 + "px";
    	popup.innerHTML = popupInfoString + ' degrees Celsius';
    	// Make the popup visible if the crosshair is inside the graph
    	if ( x > 50 ) {
    		if ( x <= width ){
    			popup.style.visibility = 'visible'
    		};
    	};
    };
  
    document.getElementById("crosshair").addEventListener("mousemove", mouseCoordinates);

    // Define the callback function
	function mouseCoordinates(e) {
    // Define spacings
    var spacing_1 = 30;
    var spacing_2 = 50;

    // Find mouse movements
		var popup = document.getElementById("popup");
		popup.style.visibility = 'hidden'
		var rect = document.getElementById("crosshair").getBoundingClientRect()
    var x = e.clientX - rect.left;
    var y = e.clientY - rect.top;

    	// Define the x values and y values
    	if (x > 50) {
    		var ix = createTransform([0, data_json.length], [spacing_2, width], true);
    		var index_x = Math.round ( ix(x) )
    		var data_y = data_json[index_x][1]
    		var data_x = data_json[index_x][0]
    		var ty = createTransform([min_temp - spacing_2, max_temp + spacing_1], [spacing_2, height], false);
    		var real_y = height - ty( data_y )
    		};
    	// Draw the crosshair
    	var canvas = document.getElementById("crosshair");
    	var context = canvas.getContext('2d');
    	context.clearRect(0, 0, width, height);
    	context.beginPath();
      if (x > 50) {
    	 context.moveTo(x, 0);
    	 context.lineTo(x, height - spacing_2);
    	 context.stroke();
      };
    	context.beginPath();
    	context.moveTo(spacing_2, real_y);
    	context.lineTo(width, real_y);
    	context.stroke();

    	// Draw the popup
    	clearTimeout(timeout);
      timeout = setTimeout(function() {drawPopup(data_x, data_y, x, real_y);}, 750);
	};

  // Define the needed variables
  var data_json = loadJSON();
  var data = pullData(data_json);
  var dates = data[0]
  var temps = data[1]
	var min_temp = data[2];
	var max_temp = data[3];
	var width = data[4];
	var height = data[5];



	// Call the functions
	draw_axis();
	draw_text(data_json);
	draw(dates, temps, '#000000');

</script>